{"expireTime":9007200852747633000,"key":"gatsby-plugin-mdx-entire-payload-6cb40ed9a45966e3aae720003203d683-","val":{"mdast":{"type":"root","children":[{"type":"import","value":"import AccentBox from \"../src/components/site/blog/accent-box.js\";","position":{"start":{"line":2,"column":1,"offset":2},"end":{"line":2,"column":67,"offset":68},"indent":[]}},{"type":"paragraph","children":[{"type":"text","value":"Following on from my article about the use-cloudinary useUpload hook - ","position":{"start":{"line":4,"column":1,"offset":72},"end":{"line":4,"column":72,"offset":143},"indent":[]}},{"type":"link","title":null,"url":"https://richardhaines.dev/use-cloudinary-hooks/","children":[{"type":"text","value":"use-cloudinary - useUpload hook","position":{"start":{"line":4,"column":73,"offset":144},"end":{"line":4,"column":104,"offset":175},"indent":[]}}],"position":{"start":{"line":4,"column":72,"offset":143},"end":{"line":4,"column":154,"offset":225},"indent":[]}},{"type":"text","value":", this time we'll be taking a look at the useSearch hook, and its a powerful beast!","position":{"start":{"line":4,"column":154,"offset":225},"end":{"line":4,"column":237,"offset":308},"indent":[]}}],"position":{"start":{"line":4,"column":1,"offset":72},"end":{"line":4,"column":237,"offset":308},"indent":[]}},{"type":"paragraph","children":[{"type":"text","value":"My use case is simple, Users upload their profile and cover image to cloudinary via the useUpload hook in ","position":{"start":{"line":6,"column":1,"offset":312},"end":{"line":6,"column":107,"offset":418},"indent":[]}},{"type":"link","title":null,"url":"https://www.devpack.dev/","children":[{"type":"text","value":"devpack","position":{"start":{"line":6,"column":108,"offset":419},"end":{"line":6,"column":115,"offset":426},"indent":[]}}],"position":{"start":{"line":6,"column":107,"offset":418},"end":{"line":6,"column":142,"offset":453},"indent":[]}},{"type":"text","value":". Each image is saved to a corresponding folder with their name and a suffix of either cover or profile. When the user next logs in to devpack they can choose to upload one of their previous 3 images that were saved in their cloudinary folders, or just upload a new image and use that one.","position":{"start":{"line":6,"column":142,"offset":453},"end":{"line":6,"column":431,"offset":742},"indent":[]}}],"position":{"start":{"line":6,"column":1,"offset":312},"end":{"line":6,"column":431,"offset":742},"indent":[]}},{"type":"paragraph","children":[{"type":"text","value":"This is where useSearch comes into play. I use it by calling a serverless function which I pass a search function with certain search parameters. Lets look at some code to get an idea of what Im talking about.","position":{"start":{"line":8,"column":1,"offset":746},"end":{"line":8,"column":210,"offset":955},"indent":[]}}],"position":{"start":{"line":8,"column":1,"offset":746},"end":{"line":8,"column":210,"offset":955},"indent":[]}},{"type":"heading","depth":2,"children":[{"type":"text","value":"Serverless function","position":{"start":{"line":10,"column":4,"offset":962},"end":{"line":10,"column":23,"offset":981},"indent":[]}}],"position":{"start":{"line":10,"column":1,"offset":959},"end":{"line":10,"column":23,"offset":981},"indent":[]}},{"type":"code","lang":"js","meta":null,"value":"const cloudinary = require(\"cloudinary\").v2;\ncloudinary.config({\n  cloud_name: process.env.CLOUDINARY_NAME,\n  api_key: process.env.CLOUDINARY_API_KEY,\n  api_secret: process.env.CLOUDINARY_API_SECRET\n});\nexports.handler = async event => {\n  const body = JSON.parse(event.body);\n  const res = await cloudinary.search\n    .expression(body.expression.expression)\n    .max_results(3)\n    .execute()\n    .then(result => result);\n  return {\n    statusCode: 200,\n    body: JSON.stringify(res)\n  };\n};","position":{"start":{"line":12,"column":1,"offset":985},"end":{"line":31,"column":4,"offset":1506},"indent":[1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1]}},{"type":"paragraph","children":[{"type":"text","value":"This function takes an event:","position":{"start":{"line":33,"column":1,"offset":1510},"end":{"line":33,"column":30,"offset":1539},"indent":[]}}],"position":{"start":{"line":33,"column":1,"offset":1510},"end":{"line":33,"column":30,"offset":1539},"indent":[]}},{"type":"list","ordered":false,"start":null,"spread":false,"children":[{"type":"listItem","spread":false,"checked":null,"children":[{"type":"paragraph","children":[{"type":"text","value":"Parses the body passing in the expression which defines our search parameters which we will define in our search function below. (Note that at the time of writing this is nested)","position":{"start":{"line":35,"column":3,"offset":1545},"end":{"line":35,"column":181,"offset":1723},"indent":[]}}],"position":{"start":{"line":35,"column":3,"offset":1545},"end":{"line":35,"column":181,"offset":1723},"indent":[]}}],"position":{"start":{"line":35,"column":1,"offset":1543},"end":{"line":35,"column":181,"offset":1723},"indent":[]}},{"type":"listItem","spread":false,"checked":null,"children":[{"type":"paragraph","children":[{"type":"text","value":"Sets the max results to 3","position":{"start":{"line":36,"column":3,"offset":1727},"end":{"line":36,"column":28,"offset":1752},"indent":[]}}],"position":{"start":{"line":36,"column":3,"offset":1727},"end":{"line":36,"column":28,"offset":1752},"indent":[]}}],"position":{"start":{"line":36,"column":1,"offset":1725},"end":{"line":36,"column":28,"offset":1752},"indent":[]}},{"type":"listItem","spread":false,"checked":null,"children":[{"type":"paragraph","children":[{"type":"text","value":"Returns an a okey 200 and the result of the search","position":{"start":{"line":37,"column":3,"offset":1756},"end":{"line":37,"column":53,"offset":1806},"indent":[]}}],"position":{"start":{"line":37,"column":3,"offset":1756},"end":{"line":37,"column":53,"offset":1806},"indent":[]}}],"position":{"start":{"line":37,"column":1,"offset":1754},"end":{"line":37,"column":53,"offset":1806},"indent":[]}}],"position":{"start":{"line":35,"column":1,"offset":1543},"end":{"line":37,"column":53,"offset":1806},"indent":[1,1]}},{"type":"heading","depth":2,"children":[{"type":"text","value":"useSearch","position":{"start":{"line":39,"column":4,"offset":1813},"end":{"line":39,"column":13,"offset":1822},"indent":[]}}],"position":{"start":{"line":39,"column":1,"offset":1810},"end":{"line":39,"column":13,"offset":1822},"indent":[]}},{"type":"blockquote","children":[{"type":"paragraph","children":[{"type":"text","value":"I've removed styles from this component","position":{"start":{"line":41,"column":3,"offset":1828},"end":{"line":41,"column":42,"offset":1867},"indent":[]}}],"position":{"start":{"line":41,"column":3,"offset":1828},"end":{"line":41,"column":42,"offset":1867},"indent":[]}}],"position":{"start":{"line":41,"column":1,"offset":1826},"end":{"line":41,"column":42,"offset":1867},"indent":[]}},{"type":"code","lang":"jsx","meta":null,"value":"import React from \"react\";\nimport Button from \"./button\";\nimport LazyImage from \"../hub/dev-card/image\";\nimport Error from \"../svg/error\";\nimport Loading from \"../svg/loading\";\nimport { useSearch } from \"use-cloudinary\";\nimport { DevCardStateContext } from \"../../context/devcard-context\";\n\nconst SavedProfileImages = () => {\n  const { search, data, isLoading, isSuccess, isError, error } = useSearch({ endpoint: \"/.netlify/functions/search\" });\n\n  // This is just a standard context with some values, such as name\n  const state = React.useContext(DevCardStateContext);\n\n  // The folder name cant have any spaces so we replace the spaces\n  let folder = `${state.name.replace(/\\s/g, \"\")}-profile`;\n\n  const customConfigSearch = React.useCallback(\n    () => search({ expression: `resource_type:image AND folder=${folder}`, config: {} }),\n    [search, folder]\n  );\n\n  if (isLoading) return <Loading />;\n  if (isError)\n    return (\n      <div>\n        <Error width=\"90px\" height=\"90px\" />\n        <p>{error.message}</p>\n      </div>\n    );\n\n  if (state.name.replace(/\\s/g, \"\") !== \"\" && isSuccess) {\n    return (\n      <div>\n        <div>\n          {data &&\n            data.resources\n              .filter(image => image.folder === getFolder())\n              .slice(0, 3)\n              .map(image => {\n                return (\n                  <LazyImage\n                    key={image.etag}\n                    publicId={image.public_id}\n                    width={100}\n                    height={100}\n                    transforms={{ height: 0.2, border: \"2px_solid_black\" }}\n                    cloudName=\"xxxxxxx\"\n                    secure_url={image.secure_url}\n                  />\n                );\n              })}\n        </div>\n        <em>Your last 3 saves are shown</em>\n      </div>\n    );\n  }\n\n  return (\n    <div>\n      <Button text=\"Load Profile Images\" onClick={() => customConfigSearch()} />\n      <em>Your last 3 saves are shown</em>\n    </div>\n  );\n};\n\nexport default SavedProfileImages;","position":{"start":{"line":43,"column":1,"offset":1871},"end":{"line":111,"column":4,"offset":3960},"indent":[1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1]}},{"type":"paragraph","children":[{"type":"text","value":"Lets break this down.","position":{"start":{"line":113,"column":1,"offset":3964},"end":{"line":113,"column":22,"offset":3985},"indent":[]}}],"position":{"start":{"line":113,"column":1,"offset":3964},"end":{"line":113,"column":22,"offset":3985},"indent":[]}},{"type":"list","ordered":false,"start":null,"spread":false,"children":[{"type":"listItem","spread":false,"checked":null,"children":[{"type":"paragraph","children":[{"type":"text","value":"The useSearch hook takes an endpoint, in our case our serverless function. It returns a search function, the data and some states.","position":{"start":{"line":115,"column":3,"offset":3991},"end":{"line":115,"column":133,"offset":4121},"indent":[]}}],"position":{"start":{"line":115,"column":3,"offset":3991},"end":{"line":115,"column":133,"offset":4121},"indent":[]}}],"position":{"start":{"line":115,"column":1,"offset":3989},"end":{"line":115,"column":133,"offset":4121},"indent":[]}},{"type":"listItem","spread":false,"checked":null,"children":[{"type":"paragraph","children":[{"type":"text","value":"The context holds our users name.","position":{"start":{"line":116,"column":3,"offset":4125},"end":{"line":116,"column":36,"offset":4158},"indent":[]}}],"position":{"start":{"line":116,"column":3,"offset":4125},"end":{"line":116,"column":36,"offset":4158},"indent":[]}}],"position":{"start":{"line":116,"column":1,"offset":4123},"end":{"line":116,"column":36,"offset":4158},"indent":[]}},{"type":"listItem","spread":false,"checked":null,"children":[{"type":"paragraph","children":[{"type":"text","value":"The customConfigSearch is the power house of this functionality. You can pass it any number of things to search by, in our case its the folder name. We use the = symbol to indicate that we want an exact match. Its wrapped in a useCallback to prevent re-rendering based on the prop changes and stop our serverless function being called again and again. This saves us on our rate limit with cloudinary.","position":{"start":{"line":117,"column":3,"offset":4162},"end":{"line":117,"column":403,"offset":4562},"indent":[]}}],"position":{"start":{"line":117,"column":3,"offset":4162},"end":{"line":117,"column":403,"offset":4562},"indent":[]}}],"position":{"start":{"line":117,"column":1,"offset":4160},"end":{"line":117,"column":403,"offset":4562},"indent":[]}},{"type":"listItem","spread":false,"checked":null,"children":[{"type":"paragraph","children":[{"type":"text","value":"The expression itself is written using the string literal syntax stating the type of media we are searching for and the exact match on the folder name.","position":{"start":{"line":118,"column":3,"offset":4566},"end":{"line":118,"column":154,"offset":4717},"indent":[]}}],"position":{"start":{"line":118,"column":3,"offset":4566},"end":{"line":118,"column":154,"offset":4717},"indent":[]}}],"position":{"start":{"line":118,"column":1,"offset":4564},"end":{"line":118,"column":154,"offset":4717},"indent":[]}},{"type":"listItem","spread":false,"checked":null,"children":[{"type":"paragraph","children":[{"type":"text","value":"The config object is optional and can also include any number of options such as tags, sort_by, max_results and many more. Note that some of these can also be added at the serverless function level. Check the docs for more info on whats possible","position":{"start":{"line":119,"column":3,"offset":4721},"end":{"line":119,"column":248,"offset":4966},"indent":[]}}],"position":{"start":{"line":119,"column":3,"offset":4721},"end":{"line":119,"column":248,"offset":4966},"indent":[]}}],"position":{"start":{"line":119,"column":1,"offset":4719},"end":{"line":119,"column":248,"offset":4966},"indent":[]}},{"type":"listItem","spread":false,"checked":null,"children":[{"type":"paragraph","children":[{"type":"text","value":"The states are handled with custom error and loading components- If the folder is a match and the data was retrieved successfully then the data array is accessed","position":{"start":{"line":120,"column":3,"offset":4970},"end":{"line":120,"column":164,"offset":5131},"indent":[]}}],"position":{"start":{"line":120,"column":3,"offset":4970},"end":{"line":120,"column":164,"offset":5131},"indent":[]}}],"position":{"start":{"line":120,"column":1,"offset":4968},"end":{"line":120,"column":164,"offset":5131},"indent":[]}},{"type":"listItem","spread":false,"checked":null,"children":[{"type":"paragraph","children":[{"type":"text","value":"The image is returned as a lazy image, which we will cover next!","position":{"start":{"line":121,"column":3,"offset":5135},"end":{"line":121,"column":67,"offset":5199},"indent":[]}}],"position":{"start":{"line":121,"column":3,"offset":5135},"end":{"line":121,"column":67,"offset":5199},"indent":[]}}],"position":{"start":{"line":121,"column":1,"offset":5133},"end":{"line":121,"column":67,"offset":5199},"indent":[]}},{"type":"listItem","spread":false,"checked":null,"children":[{"type":"paragraph","children":[{"type":"text","value":"A button calls the customConfigSearch function to load the images.","position":{"start":{"line":122,"column":3,"offset":5203},"end":{"line":122,"column":69,"offset":5269},"indent":[]}}],"position":{"start":{"line":122,"column":3,"offset":5203},"end":{"line":122,"column":69,"offset":5269},"indent":[]}}],"position":{"start":{"line":122,"column":1,"offset":5201},"end":{"line":122,"column":69,"offset":5269},"indent":[]}}],"position":{"start":{"line":115,"column":1,"offset":3989},"end":{"line":122,"column":69,"offset":5269},"indent":[1,1,1,1,1,1,1]}},{"type":"paragraph","children":[{"type":"text","value":"Phew! That was a lot to take in! 😅","position":{"start":{"line":124,"column":1,"offset":5273},"end":{"line":124,"column":36,"offset":5308},"indent":[]}}],"position":{"start":{"line":124,"column":1,"offset":5273},"end":{"line":124,"column":36,"offset":5308},"indent":[]}},{"type":"paragraph","children":[{"type":"text","value":"The lazy image is a component that lazy loads an image with a placeholder. Handy!","position":{"start":{"line":126,"column":1,"offset":5312},"end":{"line":126,"column":82,"offset":5393},"indent":[]}}],"position":{"start":{"line":126,"column":1,"offset":5312},"end":{"line":126,"column":82,"offset":5393},"indent":[]}},{"type":"heading","depth":2,"children":[{"type":"text","value":"Lazy load image","position":{"start":{"line":128,"column":4,"offset":5400},"end":{"line":128,"column":19,"offset":5415},"indent":[]}}],"position":{"start":{"line":128,"column":1,"offset":5397},"end":{"line":128,"column":19,"offset":5415},"indent":[]}},{"type":"code","lang":"jsx","meta":null,"value":"import React from \"react\";\nimport { useImage } from \"use-cloudinary\";\nimport { DevCardDispatchContext } from \"../../../context/devcard-context\";\n\n// Image w/ Lazy-load + placeholder\nfunction LazyImage({ publicId, transformations, width, height, cloudName, secure_url, isProfile }) {\n  const { generateUrl, blurredPlaceholderUrl, isError, error, ref, supportsLazyLoading, inView, isSuccess } = useImage({\n    cloudName\n  });\n  const dispatch = React.useContext(DevCardDispatchContext);\n  React.useEffect(() => {\n    generateUrl({\n      publicId,\n      transformations: {\n        width,\n        height,\n        ...transformations\n      }\n    });\n    // eslint-disable-next-line react-hooks/exhaustive-deps\n  }, []);\n  if (isError) return <p>{error.message}</p>;\n  return (\n    <div\n      ref={!supportsLazyLoading ? ref : undefined}\n      style={{\n        width: `${width}px`,\n        height: `${height}px`,\n        background: `no-repeat url(${blurredPlaceholderUrl(publicId, width, height)})`,\n        cursor: \"pointer\",\n        outline: \"none\"\n      }}\n      role=\"button\"\n      tabindex=\"0\"\n      onKeyPress={() =>\n        dispatch({ type: isProfile ? \"selectedProfileImage\" : \"selectedCoverImage\", payload: secure_url })\n      }\n      onClick={() => dispatch({ type: isProfile ? \"selectedProfileImage\" : \"selectedCoverImage\", payload: secure_url })}\n    >\n      {inView || (supportsLazyLoading && isSuccess) ? (\n        <img\n          src={secure_url}\n          loading=\"lazy\"\n          style={{\n            width: `${width}px`,\n            height: `${height}px`,\n            border: \"solid 2px\"\n          }}\n          alt=\"Lazy loaded profile\"\n        />\n      ) : null}\n    </div>\n  );\n}\n\nexport default LazyImage;","position":{"start":{"line":130,"column":1,"offset":5419},"end":{"line":187,"column":4,"offset":7206},"indent":[1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1]}},{"type":"jsx","value":"<AccentBox>\nOne thing to note about using this component with Gatsby is that the base image url wont load the image, you have to use the https secure_url for it to work.\n</AccentBox>","position":{"start":{"line":188,"column":1,"offset":7208},"end":{"line":190,"column":13,"offset":7392},"indent":[1,1]}},{"type":"paragraph","children":[{"type":"text","value":"And thats it! It's a pretty powerful way to load your images via user defined events. Check the ","position":{"start":{"line":192,"column":1,"offset":7396},"end":{"line":192,"column":97,"offset":7492},"indent":[]}},{"type":"link","title":null,"url":"https://use-cloudinary.netlify.app/usage/use-search","children":[{"type":"text","value":"useSearch docs","position":{"start":{"line":192,"column":98,"offset":7493},"end":{"line":192,"column":112,"offset":7507},"indent":[]}}],"position":{"start":{"line":192,"column":97,"offset":7492},"end":{"line":192,"column":166,"offset":7561},"indent":[]}},{"type":"text","value":" for a run down of whats possible with the hook.","position":{"start":{"line":192,"column":166,"offset":7561},"end":{"line":192,"column":214,"offset":7609},"indent":[]}}],"position":{"start":{"line":192,"column":1,"offset":7396},"end":{"line":192,"column":214,"offset":7609},"indent":[]}},{"type":"export","value":"export const _frontmatter = {\"title\":\"use-cloudinary - useSearch\",\"date\":\"2020-08-11T00:00:00.000Z\",\"published\":true,\"category\":\"First Look\",\"author\":\"Richard Haines\",\"keywords\":[\"cloudinary\",\"use-cloudinary\",\"hooks\"],\"pin\":false}","position":{"start":{"line":195,"column":1,"offset":7613},"end":{"line":195,"column":231,"offset":7843},"indent":[]}}],"position":{"start":{"line":1,"column":1,"offset":0},"end":{"line":195,"column":231,"offset":7843}}},"scopeImports":["import AccentBox from \"../src/components/site/blog/accent-box.js\";","import React from 'react'"],"scopeIdentifiers":["AccentBox","React"],"body":"function _extends() { _extends = Object.assign || function (target) { for (var i = 1; i < arguments.length; i++) { var source = arguments[i]; for (var key in source) { if (Object.prototype.hasOwnProperty.call(source, key)) { target[key] = source[key]; } } } return target; }; return _extends.apply(this, arguments); }\n\nfunction _objectWithoutProperties(source, excluded) { if (source == null) return {}; var target = _objectWithoutPropertiesLoose(source, excluded); var key, i; if (Object.getOwnPropertySymbols) { var sourceSymbolKeys = Object.getOwnPropertySymbols(source); for (i = 0; i < sourceSymbolKeys.length; i++) { key = sourceSymbolKeys[i]; if (excluded.indexOf(key) >= 0) continue; if (!Object.prototype.propertyIsEnumerable.call(source, key)) continue; target[key] = source[key]; } } return target; }\n\nfunction _objectWithoutPropertiesLoose(source, excluded) { if (source == null) return {}; var target = {}; var sourceKeys = Object.keys(source); var key, i; for (i = 0; i < sourceKeys.length; i++) { key = sourceKeys[i]; if (excluded.indexOf(key) >= 0) continue; target[key] = source[key]; } return target; }\n\n/* @jsx mdx */\nvar _frontmatter = {\n  \"title\": \"use-cloudinary - useSearch\",\n  \"date\": \"2020-08-11T00:00:00.000Z\",\n  \"published\": true,\n  \"category\": \"First Look\",\n  \"author\": \"Richard Haines\",\n  \"keywords\": [\"cloudinary\", \"use-cloudinary\", \"hooks\"],\n  \"pin\": false\n};\n\nvar makeShortcode = function makeShortcode(name) {\n  return function MDXDefaultShortcode(props) {\n    console.warn(\"Component \" + name + \" was not imported, exported, or provided by MDXProvider as global scope\");\n    return mdx(\"div\", props);\n  };\n};\n\nvar layoutProps = {\n  _frontmatter: _frontmatter\n};\nvar MDXLayout = \"wrapper\";\nreturn function MDXContent(_ref) {\n  var components = _ref.components,\n      props = _objectWithoutProperties(_ref, [\"components\"]);\n\n  return mdx(MDXLayout, _extends({}, layoutProps, props, {\n    components: components,\n    mdxType: \"MDXLayout\"\n  }), mdx(\"p\", null, \"Following on from my article about the use-cloudinary useUpload hook - \", mdx(\"a\", _extends({\n    parentName: \"p\"\n  }, {\n    \"href\": \"https://richardhaines.dev/use-cloudinary-hooks/\"\n  }), \"use-cloudinary - useUpload hook\"), \", this time we'll be taking a look at the useSearch hook, and its a powerful beast!\"), mdx(\"p\", null, \"My use case is simple, Users upload their profile and cover image to cloudinary via the useUpload hook in \", mdx(\"a\", _extends({\n    parentName: \"p\"\n  }, {\n    \"href\": \"https://www.devpack.dev/\"\n  }), \"devpack\"), \". Each image is saved to a corresponding folder with their name and a suffix of either cover or profile. When the user next logs in to devpack they can choose to upload one of their previous 3 images that were saved in their cloudinary folders, or just upload a new image and use that one.\"), mdx(\"p\", null, \"This is where useSearch comes into play. I use it by calling a serverless function which I pass a search function with certain search parameters. Lets look at some code to get an idea of what Im talking about.\"), mdx(\"h2\", {\n    \"id\": \"serverless-function\"\n  }, \"Serverless function\"), mdx(\"pre\", null, mdx(\"code\", _extends({\n    parentName: \"pre\"\n  }, {\n    \"className\": \"language-js\"\n  }), \"const cloudinary = require(\\\"cloudinary\\\").v2;\\ncloudinary.config({\\n  cloud_name: process.env.CLOUDINARY_NAME,\\n  api_key: process.env.CLOUDINARY_API_KEY,\\n  api_secret: process.env.CLOUDINARY_API_SECRET\\n});\\nexports.handler = async event => {\\n  const body = JSON.parse(event.body);\\n  const res = await cloudinary.search\\n    .expression(body.expression.expression)\\n    .max_results(3)\\n    .execute()\\n    .then(result => result);\\n  return {\\n    statusCode: 200,\\n    body: JSON.stringify(res)\\n  };\\n};\\n\")), mdx(\"p\", null, \"This function takes an event:\"), mdx(\"ul\", null, mdx(\"li\", {\n    parentName: \"ul\"\n  }, \"Parses the body passing in the expression which defines our search parameters which we will define in our search function below. (Note that at the time of writing this is nested)\"), mdx(\"li\", {\n    parentName: \"ul\"\n  }, \"Sets the max results to 3\"), mdx(\"li\", {\n    parentName: \"ul\"\n  }, \"Returns an a okey 200 and the result of the search\")), mdx(\"h2\", {\n    \"id\": \"usesearch\"\n  }, \"useSearch\"), mdx(\"blockquote\", null, mdx(\"p\", {\n    parentName: \"blockquote\"\n  }, \"I've removed styles from this component\")), mdx(\"pre\", null, mdx(\"code\", _extends({\n    parentName: \"pre\"\n  }, {\n    \"className\": \"language-jsx\"\n  }), \"import React from \\\"react\\\";\\nimport Button from \\\"./button\\\";\\nimport LazyImage from \\\"../hub/dev-card/image\\\";\\nimport Error from \\\"../svg/error\\\";\\nimport Loading from \\\"../svg/loading\\\";\\nimport { useSearch } from \\\"use-cloudinary\\\";\\nimport { DevCardStateContext } from \\\"../../context/devcard-context\\\";\\n\\nconst SavedProfileImages = () => {\\n  const { search, data, isLoading, isSuccess, isError, error } = useSearch({ endpoint: \\\"/.netlify/functions/search\\\" });\\n\\n  // This is just a standard context with some values, such as name\\n  const state = React.useContext(DevCardStateContext);\\n\\n  // The folder name cant have any spaces so we replace the spaces\\n  let folder = `${state.name.replace(/\\\\s/g, \\\"\\\")}-profile`;\\n\\n  const customConfigSearch = React.useCallback(\\n    () => search({ expression: `resource_type:image AND folder=${folder}`, config: {} }),\\n    [search, folder]\\n  );\\n\\n  if (isLoading) return <Loading />;\\n  if (isError)\\n    return (\\n      <div>\\n        <Error width=\\\"90px\\\" height=\\\"90px\\\" />\\n        <p>{error.message}</p>\\n      </div>\\n    );\\n\\n  if (state.name.replace(/\\\\s/g, \\\"\\\") !== \\\"\\\" && isSuccess) {\\n    return (\\n      <div>\\n        <div>\\n          {data &&\\n            data.resources\\n              .filter(image => image.folder === getFolder())\\n              .slice(0, 3)\\n              .map(image => {\\n                return (\\n                  <LazyImage\\n                    key={image.etag}\\n                    publicId={image.public_id}\\n                    width={100}\\n                    height={100}\\n                    transforms={{ height: 0.2, border: \\\"2px_solid_black\\\" }}\\n                    cloudName=\\\"xxxxxxx\\\"\\n                    secure_url={image.secure_url}\\n                  />\\n                );\\n              })}\\n        </div>\\n        <em>Your last 3 saves are shown</em>\\n      </div>\\n    );\\n  }\\n\\n  return (\\n    <div>\\n      <Button text=\\\"Load Profile Images\\\" onClick={() => customConfigSearch()} />\\n      <em>Your last 3 saves are shown</em>\\n    </div>\\n  );\\n};\\n\\nexport default SavedProfileImages;\\n\")), mdx(\"p\", null, \"Lets break this down.\"), mdx(\"ul\", null, mdx(\"li\", {\n    parentName: \"ul\"\n  }, \"The useSearch hook takes an endpoint, in our case our serverless function. It returns a search function, the data and some states.\"), mdx(\"li\", {\n    parentName: \"ul\"\n  }, \"The context holds our users name.\"), mdx(\"li\", {\n    parentName: \"ul\"\n  }, \"The customConfigSearch is the power house of this functionality. You can pass it any number of things to search by, in our case its the folder name. We use the = symbol to indicate that we want an exact match. Its wrapped in a useCallback to prevent re-rendering based on the prop changes and stop our serverless function being called again and again. This saves us on our rate limit with cloudinary.\"), mdx(\"li\", {\n    parentName: \"ul\"\n  }, \"The expression itself is written using the string literal syntax stating the type of media we are searching for and the exact match on the folder name.\"), mdx(\"li\", {\n    parentName: \"ul\"\n  }, \"The config object is optional and can also include any number of options such as tags, sort_by, max_results and many more. Note that some of these can also be added at the serverless function level. Check the docs for more info on whats possible\"), mdx(\"li\", {\n    parentName: \"ul\"\n  }, \"The states are handled with custom error and loading components- If the folder is a match and the data was retrieved successfully then the data array is accessed\"), mdx(\"li\", {\n    parentName: \"ul\"\n  }, \"The image is returned as a lazy image, which we will cover next!\"), mdx(\"li\", {\n    parentName: \"ul\"\n  }, \"A button calls the customConfigSearch function to load the images.\")), mdx(\"p\", null, \"Phew! That was a lot to take in! \\uD83D\\uDE05\"), mdx(\"p\", null, \"The lazy image is a component that lazy loads an image with a placeholder. Handy!\"), mdx(\"h2\", {\n    \"id\": \"lazy-load-image\"\n  }, \"Lazy load image\"), mdx(\"pre\", null, mdx(\"code\", _extends({\n    parentName: \"pre\"\n  }, {\n    \"className\": \"language-jsx\"\n  }), \"import React from \\\"react\\\";\\nimport { useImage } from \\\"use-cloudinary\\\";\\nimport { DevCardDispatchContext } from \\\"../../../context/devcard-context\\\";\\n\\n// Image w/ Lazy-load + placeholder\\nfunction LazyImage({ publicId, transformations, width, height, cloudName, secure_url, isProfile }) {\\n  const { generateUrl, blurredPlaceholderUrl, isError, error, ref, supportsLazyLoading, inView, isSuccess } = useImage({\\n    cloudName\\n  });\\n  const dispatch = React.useContext(DevCardDispatchContext);\\n  React.useEffect(() => {\\n    generateUrl({\\n      publicId,\\n      transformations: {\\n        width,\\n        height,\\n        ...transformations\\n      }\\n    });\\n    // eslint-disable-next-line react-hooks/exhaustive-deps\\n  }, []);\\n  if (isError) return <p>{error.message}</p>;\\n  return (\\n    <div\\n      ref={!supportsLazyLoading ? ref : undefined}\\n      style={{\\n        width: `${width}px`,\\n        height: `${height}px`,\\n        background: `no-repeat url(${blurredPlaceholderUrl(publicId, width, height)})`,\\n        cursor: \\\"pointer\\\",\\n        outline: \\\"none\\\"\\n      }}\\n      role=\\\"button\\\"\\n      tabindex=\\\"0\\\"\\n      onKeyPress={() =>\\n        dispatch({ type: isProfile ? \\\"selectedProfileImage\\\" : \\\"selectedCoverImage\\\", payload: secure_url })\\n      }\\n      onClick={() => dispatch({ type: isProfile ? \\\"selectedProfileImage\\\" : \\\"selectedCoverImage\\\", payload: secure_url })}\\n    >\\n      {inView || (supportsLazyLoading && isSuccess) ? (\\n        <img\\n          src={secure_url}\\n          loading=\\\"lazy\\\"\\n          style={{\\n            width: `${width}px`,\\n            height: `${height}px`,\\n            border: \\\"solid 2px\\\"\\n          }}\\n          alt=\\\"Lazy loaded profile\\\"\\n        />\\n      ) : null}\\n    </div>\\n  );\\n}\\n\\nexport default LazyImage;\\n\")), mdx(AccentBox, {\n    mdxType: \"AccentBox\"\n  }, \"One thing to note about using this component with Gatsby is that the base image url wont load the image, you have to use the https secure_url for it to work.\"), mdx(\"p\", null, \"And thats it! It's a pretty powerful way to load your images via user defined events. Check the \", mdx(\"a\", _extends({\n    parentName: \"p\"\n  }, {\n    \"href\": \"https://use-cloudinary.netlify.app/usage/use-search\"\n  }), \"useSearch docs\"), \" for a run down of whats possible with the hook.\"));\n}\n;\nMDXContent.isMDXComponent = true;","rawMDXOutput":"/* @jsx mdx */\nimport { mdx } from '@mdx-js/react';\n/* @jsx mdx */\nimport AccentBox from \"../src/components/site/blog/accent-box.js\";\nexport const _frontmatter = {\n  \"title\": \"use-cloudinary - useSearch\",\n  \"date\": \"2020-08-11T00:00:00.000Z\",\n  \"published\": true,\n  \"category\": \"First Look\",\n  \"author\": \"Richard Haines\",\n  \"keywords\": [\"cloudinary\", \"use-cloudinary\", \"hooks\"],\n  \"pin\": false\n};\nconst makeShortcode = name => function MDXDefaultShortcode(props) {\n  console.warn(\"Component \" + name + \" was not imported, exported, or provided by MDXProvider as global scope\")\n  return <div {...props}/>\n};\n\nconst layoutProps = {\n  _frontmatter\n};\nconst MDXLayout = \"wrapper\"\nexport default function MDXContent({\n  components,\n  ...props\n}) {\n  return <MDXLayout {...layoutProps} {...props} components={components} mdxType=\"MDXLayout\">\n\n    <p>{`Following on from my article about the use-cloudinary useUpload hook - `}<a parentName=\"p\" {...{\n        \"href\": \"https://richardhaines.dev/use-cloudinary-hooks/\"\n      }}>{`use-cloudinary - useUpload hook`}</a>{`, this time we'll be taking a look at the useSearch hook, and its a powerful beast!`}</p>\n    <p>{`My use case is simple, Users upload their profile and cover image to cloudinary via the useUpload hook in `}<a parentName=\"p\" {...{\n        \"href\": \"https://www.devpack.dev/\"\n      }}>{`devpack`}</a>{`. Each image is saved to a corresponding folder with their name and a suffix of either cover or profile. When the user next logs in to devpack they can choose to upload one of their previous 3 images that were saved in their cloudinary folders, or just upload a new image and use that one.`}</p>\n    <p>{`This is where useSearch comes into play. I use it by calling a serverless function which I pass a search function with certain search parameters. Lets look at some code to get an idea of what Im talking about.`}</p>\n    <h2 {...{\n      \"id\": \"serverless-function\"\n    }}>{`Serverless function`}</h2>\n    <pre><code parentName=\"pre\" {...{\n        \"className\": \"language-js\"\n      }}>{`const cloudinary = require(\"cloudinary\").v2;\ncloudinary.config({\n  cloud_name: process.env.CLOUDINARY_NAME,\n  api_key: process.env.CLOUDINARY_API_KEY,\n  api_secret: process.env.CLOUDINARY_API_SECRET\n});\nexports.handler = async event => {\n  const body = JSON.parse(event.body);\n  const res = await cloudinary.search\n    .expression(body.expression.expression)\n    .max_results(3)\n    .execute()\n    .then(result => result);\n  return {\n    statusCode: 200,\n    body: JSON.stringify(res)\n  };\n};\n`}</code></pre>\n    <p>{`This function takes an event:`}</p>\n    <ul>\n      <li parentName=\"ul\">{`Parses the body passing in the expression which defines our search parameters which we will define in our search function below. (Note that at the time of writing this is nested)`}</li>\n      <li parentName=\"ul\">{`Sets the max results to 3`}</li>\n      <li parentName=\"ul\">{`Returns an a okey 200 and the result of the search`}</li>\n    </ul>\n    <h2 {...{\n      \"id\": \"usesearch\"\n    }}>{`useSearch`}</h2>\n    <blockquote>\n      <p parentName=\"blockquote\">{`I've removed styles from this component`}</p>\n    </blockquote>\n    <pre><code parentName=\"pre\" {...{\n        \"className\": \"language-jsx\"\n      }}>{`import React from \"react\";\nimport Button from \"./button\";\nimport LazyImage from \"../hub/dev-card/image\";\nimport Error from \"../svg/error\";\nimport Loading from \"../svg/loading\";\nimport { useSearch } from \"use-cloudinary\";\nimport { DevCardStateContext } from \"../../context/devcard-context\";\n\nconst SavedProfileImages = () => {\n  const { search, data, isLoading, isSuccess, isError, error } = useSearch({ endpoint: \"/.netlify/functions/search\" });\n\n  // This is just a standard context with some values, such as name\n  const state = React.useContext(DevCardStateContext);\n\n  // The folder name cant have any spaces so we replace the spaces\n  let folder = \\`\\${state.name.replace(/\\\\s/g, \"\")}-profile\\`;\n\n  const customConfigSearch = React.useCallback(\n    () => search({ expression: \\`resource_type:image AND folder=\\${folder}\\`, config: {} }),\n    [search, folder]\n  );\n\n  if (isLoading) return <Loading />;\n  if (isError)\n    return (\n      <div>\n        <Error width=\"90px\" height=\"90px\" />\n        <p>{error.message}</p>\n      </div>\n    );\n\n  if (state.name.replace(/\\\\s/g, \"\") !== \"\" && isSuccess) {\n    return (\n      <div>\n        <div>\n          {data &&\n            data.resources\n              .filter(image => image.folder === getFolder())\n              .slice(0, 3)\n              .map(image => {\n                return (\n                  <LazyImage\n                    key={image.etag}\n                    publicId={image.public_id}\n                    width={100}\n                    height={100}\n                    transforms={{ height: 0.2, border: \"2px_solid_black\" }}\n                    cloudName=\"xxxxxxx\"\n                    secure_url={image.secure_url}\n                  />\n                );\n              })}\n        </div>\n        <em>Your last 3 saves are shown</em>\n      </div>\n    );\n  }\n\n  return (\n    <div>\n      <Button text=\"Load Profile Images\" onClick={() => customConfigSearch()} />\n      <em>Your last 3 saves are shown</em>\n    </div>\n  );\n};\n\nexport default SavedProfileImages;\n`}</code></pre>\n    <p>{`Lets break this down.`}</p>\n    <ul>\n      <li parentName=\"ul\">{`The useSearch hook takes an endpoint, in our case our serverless function. It returns a search function, the data and some states.`}</li>\n      <li parentName=\"ul\">{`The context holds our users name.`}</li>\n      <li parentName=\"ul\">{`The customConfigSearch is the power house of this functionality. You can pass it any number of things to search by, in our case its the folder name. We use the = symbol to indicate that we want an exact match. Its wrapped in a useCallback to prevent re-rendering based on the prop changes and stop our serverless function being called again and again. This saves us on our rate limit with cloudinary.`}</li>\n      <li parentName=\"ul\">{`The expression itself is written using the string literal syntax stating the type of media we are searching for and the exact match on the folder name.`}</li>\n      <li parentName=\"ul\">{`The config object is optional and can also include any number of options such as tags, sort_by, max_results and many more. Note that some of these can also be added at the serverless function level. Check the docs for more info on whats possible`}</li>\n      <li parentName=\"ul\">{`The states are handled with custom error and loading components- If the folder is a match and the data was retrieved successfully then the data array is accessed`}</li>\n      <li parentName=\"ul\">{`The image is returned as a lazy image, which we will cover next!`}</li>\n      <li parentName=\"ul\">{`A button calls the customConfigSearch function to load the images.`}</li>\n    </ul>\n    <p>{`Phew! That was a lot to take in! 😅`}</p>\n    <p>{`The lazy image is a component that lazy loads an image with a placeholder. Handy!`}</p>\n    <h2 {...{\n      \"id\": \"lazy-load-image\"\n    }}>{`Lazy load image`}</h2>\n    <pre><code parentName=\"pre\" {...{\n        \"className\": \"language-jsx\"\n      }}>{`import React from \"react\";\nimport { useImage } from \"use-cloudinary\";\nimport { DevCardDispatchContext } from \"../../../context/devcard-context\";\n\n// Image w/ Lazy-load + placeholder\nfunction LazyImage({ publicId, transformations, width, height, cloudName, secure_url, isProfile }) {\n  const { generateUrl, blurredPlaceholderUrl, isError, error, ref, supportsLazyLoading, inView, isSuccess } = useImage({\n    cloudName\n  });\n  const dispatch = React.useContext(DevCardDispatchContext);\n  React.useEffect(() => {\n    generateUrl({\n      publicId,\n      transformations: {\n        width,\n        height,\n        ...transformations\n      }\n    });\n    // eslint-disable-next-line react-hooks/exhaustive-deps\n  }, []);\n  if (isError) return <p>{error.message}</p>;\n  return (\n    <div\n      ref={!supportsLazyLoading ? ref : undefined}\n      style={{\n        width: \\`\\${width}px\\`,\n        height: \\`\\${height}px\\`,\n        background: \\`no-repeat url(\\${blurredPlaceholderUrl(publicId, width, height)})\\`,\n        cursor: \"pointer\",\n        outline: \"none\"\n      }}\n      role=\"button\"\n      tabindex=\"0\"\n      onKeyPress={() =>\n        dispatch({ type: isProfile ? \"selectedProfileImage\" : \"selectedCoverImage\", payload: secure_url })\n      }\n      onClick={() => dispatch({ type: isProfile ? \"selectedProfileImage\" : \"selectedCoverImage\", payload: secure_url })}\n    >\n      {inView || (supportsLazyLoading && isSuccess) ? (\n        <img\n          src={secure_url}\n          loading=\"lazy\"\n          style={{\n            width: \\`\\${width}px\\`,\n            height: \\`\\${height}px\\`,\n            border: \"solid 2px\"\n          }}\n          alt=\"Lazy loaded profile\"\n        />\n      ) : null}\n    </div>\n  );\n}\n\nexport default LazyImage;\n`}</code></pre>\n    <AccentBox mdxType=\"AccentBox\">\nOne thing to note about using this component with Gatsby is that the base image url wont load the image, you have to use the https secure_url for it to work.\n    </AccentBox>\n    <p>{`And thats it! It's a pretty powerful way to load your images via user defined events. Check the `}<a parentName=\"p\" {...{\n        \"href\": \"https://use-cloudinary.netlify.app/usage/use-search\"\n      }}>{`useSearch docs`}</a>{` for a run down of whats possible with the hook.`}</p>\n\n    </MDXLayout>;\n}\n\n;\nMDXContent.isMDXComponent = true;"}}