{"expireTime":9007200851906807000,"key":"gatsby-plugin-mdx-entire-payload-872aa44d58fcf9ac81e956c9d94ca654-","val":{"mdast":{"type":"root","children":[{"type":"heading","depth":2,"children":[{"type":"text","value":"Setup","position":{"start":{"line":2,"column":4,"offset":5},"end":{"line":2,"column":9,"offset":10},"indent":[]}}],"position":{"start":{"line":2,"column":1,"offset":2},"end":{"line":2,"column":9,"offset":10},"indent":[]}},{"type":"paragraph","children":[{"type":"text","value":"Im currently working on a project which will be a mobile app for parents to swap\nunused items. To do this im using ","position":{"start":{"line":4,"column":1,"offset":14},"end":{"line":5,"column":35,"offset":130},"indent":[1]}},{"type":"link","title":null,"url":"https://expo.io/","children":[{"type":"text","value":"Expo","position":{"start":{"line":5,"column":36,"offset":131},"end":{"line":5,"column":40,"offset":135},"indent":[]}}],"position":{"start":{"line":5,"column":35,"offset":130},"end":{"line":5,"column":59,"offset":154},"indent":[]}},{"type":"text","value":" with a\n","position":{"start":{"line":5,"column":59,"offset":154},"end":{"line":6,"column":1,"offset":163},"indent":[1]}},{"type":"link","title":null,"url":"https://fauna.com/","children":[{"type":"text","value":"FaunaDB","position":{"start":{"line":6,"column":2,"offset":164},"end":{"line":6,"column":9,"offset":171},"indent":[]}}],"position":{"start":{"line":6,"column":1,"offset":163},"end":{"line":6,"column":30,"offset":192},"indent":[]}},{"type":"text","value":" database. I had already setup a project with Fauna\nand Gatsby so thought the knowledge transfer would be quite simple. And it was,\nuntil it wasn't.","position":{"start":{"line":6,"column":30,"offset":192},"end":{"line":8,"column":17,"offset":342},"indent":[1,1]}}],"position":{"start":{"line":4,"column":1,"offset":14},"end":{"line":8,"column":17,"offset":342},"indent":[1,1,1,1]}},{"type":"paragraph","children":[{"type":"text","value":"The problem with trying to access the Fauna database from a React Native (RN)\napp is that RN doesn't come with or support the Node Standard Library, which\nFauna uses. The solution, or the one I found, is to create a separate API to\nhandle the Fauna side of things and access that API form the app. Let's go\nthrough a simple setup to see how this is done.","position":{"start":{"line":10,"column":1,"offset":346},"end":{"line":14,"column":48,"offset":704},"indent":[1,1,1,1]}}],"position":{"start":{"line":10,"column":1,"offset":346},"end":{"line":14,"column":48,"offset":704},"indent":[1,1,1,1]}},{"type":"paragraph","children":[{"type":"text","value":"Make sure you have installed the expo-cli and now-cli.","position":{"start":{"line":16,"column":1,"offset":708},"end":{"line":16,"column":55,"offset":762},"indent":[]}}],"position":{"start":{"line":16,"column":1,"offset":708},"end":{"line":16,"column":55,"offset":762},"indent":[]}},{"type":"code","lang":"bash","meta":null,"value":"yarn global add expo-cli\nyarn global add vercel","position":{"start":{"line":18,"column":1,"offset":766},"end":{"line":21,"column":4,"offset":828},"indent":[1,1,1]}},{"type":"paragraph","children":[{"type":"text","value":"Create a new expo project, follow the instructions (you can choose a blank or\ntabs template) and open your code editor","position":{"start":{"line":23,"column":1,"offset":832},"end":{"line":24,"column":41,"offset":951},"indent":[1]}}],"position":{"start":{"line":23,"column":1,"offset":832},"end":{"line":24,"column":41,"offset":951},"indent":[1]}},{"type":"code","lang":"bash","meta":null,"value":"expo init myProject\ncd myProject\ncode .","position":{"start":{"line":26,"column":1,"offset":955},"end":{"line":30,"column":4,"offset":1010},"indent":[1,1,1,1]}},{"type":"paragraph","children":[{"type":"text","value":"Ok, leave the app for a minute and login to your Fauna account, create a new\ndatabase and name it whatever you like. Perhaps MySuperDB? Create a new key with\na server role. Name it FAUNA_SERVER. Make a note of it as it wont be shown\nagain.","position":{"start":{"line":32,"column":1,"offset":1014},"end":{"line":35,"column":7,"offset":1256},"indent":[1,1,1]}}],"position":{"start":{"line":32,"column":1,"offset":1014},"end":{"line":35,"column":7,"offset":1256},"indent":[1,1,1]}},{"type":"paragraph","children":[{"type":"text","value":"Back to our app we now need to add some packages. Its a long list so just do it\nall in one.","position":{"start":{"line":37,"column":1,"offset":1260},"end":{"line":38,"column":12,"offset":1352},"indent":[1]}}],"position":{"start":{"line":37,"column":1,"offset":1260},"end":{"line":38,"column":12,"offset":1352},"indent":[1]}},{"type":"code","lang":"bash","meta":null,"value":"yarn add @apollo/client apollo-link-context apollo-link-http graphql graphql-tag isomorphic-fetch\n\nyarn add react-native-dotenv -D","position":{"start":{"line":40,"column":1,"offset":1356},"end":{"line":44,"column":4,"offset":1502},"indent":[1,1,1,1]}},{"type":"heading","depth":2,"children":[{"type":"text","value":"Adding Apollo","position":{"start":{"line":46,"column":4,"offset":1509},"end":{"line":46,"column":17,"offset":1522},"indent":[]}}],"position":{"start":{"line":46,"column":1,"offset":1506},"end":{"line":46,"column":17,"offset":1522},"indent":[]}},{"type":"paragraph","children":[{"type":"text","value":"First we want to setup our Apollo Provider which will wrap our root component,\nApp.js. Create a new file in the constants folder and name it apollo.js","position":{"start":{"line":48,"column":1,"offset":1526},"end":{"line":49,"column":72,"offset":1677},"indent":[1]}}],"position":{"start":{"line":48,"column":1,"offset":1526},"end":{"line":49,"column":72,"offset":1677},"indent":[1]}},{"type":"code","lang":"jsx","meta":null,"value":"const React = require(\"react\");\nimport { FAUNA_SERVER } from \"react-native-dotenv\";\nconst {\n  ApolloProvider,\n  ApolloClient,\n  InMemoryCache\n} = require(\"@apollo/client\");\nconst { setContext } = require(\"apollo-link-context\");\nconst { createHttpLink } = require(\"apollo-link-http\");\nconst fetch = require(\"isomorphic-fetch\");\n\nconst httpLink = createHttpLink({\n  uri: \"https://graphql.fauna.com/graphql\",\n  fetch\n});\n\nconst authLink = setContext((_, { headers }) => {\n  return {\n    headers: {\n      ...headers,\n      authorization: `Bearer ${FAUNA_SERVER}`\n    }\n  };\n});\n\nconst client = new ApolloClient({\n  link: authLink.concat(httpLink),\n  cache: new InMemoryCache()\n});\n\nconst Apollo = ({ children }) => (\n  <ApolloProvider client={client}>{children}</ApolloProvider>\n);\n\nexport default Apollo;","position":{"start":{"line":51,"column":1,"offset":1681},"end":{"line":87,"column":4,"offset":2529},"indent":[1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1]}},{"type":"paragraph","children":[{"type":"text","value":"The above code can be boiled down to:","position":{"start":{"line":89,"column":1,"offset":2533},"end":{"line":89,"column":38,"offset":2570},"indent":[]}}],"position":{"start":{"line":89,"column":1,"offset":2533},"end":{"line":89,"column":38,"offset":2570},"indent":[]}},{"type":"list","ordered":false,"start":null,"spread":false,"children":[{"type":"listItem","spread":false,"checked":null,"children":[{"type":"paragraph","children":[{"type":"text","value":"Created a new http link","position":{"start":{"line":91,"column":3,"offset":2576},"end":{"line":91,"column":26,"offset":2599},"indent":[]}}],"position":{"start":{"line":91,"column":3,"offset":2576},"end":{"line":91,"column":26,"offset":2599},"indent":[]}}],"position":{"start":{"line":91,"column":1,"offset":2574},"end":{"line":91,"column":26,"offset":2599},"indent":[]}},{"type":"listItem","spread":false,"checked":null,"children":[{"type":"paragraph","children":[{"type":"text","value":"Create an auth link which returns the headers to the context so the http link\ncan read them. Here we pass in our Fauna key with server rights.","position":{"start":{"line":92,"column":3,"offset":2603},"end":{"line":93,"column":67,"offset":2748},"indent":[3]}}],"position":{"start":{"line":92,"column":3,"offset":2603},"end":{"line":93,"column":67,"offset":2748},"indent":[3]}}],"position":{"start":{"line":92,"column":1,"offset":2601},"end":{"line":93,"column":67,"offset":2748},"indent":[1]}},{"type":"listItem","spread":false,"checked":null,"children":[{"type":"paragraph","children":[{"type":"text","value":"Then we create the client to be passed to the provider with the link now set\nas the auth link.","position":{"start":{"line":94,"column":3,"offset":2752},"end":{"line":95,"column":20,"offset":2849},"indent":[3]}}],"position":{"start":{"line":94,"column":3,"offset":2752},"end":{"line":95,"column":20,"offset":2849},"indent":[3]}}],"position":{"start":{"line":94,"column":1,"offset":2750},"end":{"line":95,"column":20,"offset":2849},"indent":[1]}}],"position":{"start":{"line":91,"column":1,"offset":2574},"end":{"line":95,"column":20,"offset":2849},"indent":[1,1,1,1]}},{"type":"paragraph","children":[{"type":"text","value":"Create a new .env file at the projects root and add your fauna server key, using\nthe name we gave it in our fauna dashboard.","position":{"start":{"line":97,"column":1,"offset":2853},"end":{"line":98,"column":44,"offset":2978},"indent":[1]}}],"position":{"start":{"line":97,"column":1,"offset":2853},"end":{"line":98,"column":44,"offset":2978},"indent":[1]}},{"type":"code","lang":"bash","meta":null,"value":"FAUNA_SERVER=xxxxxxxxxxxxxxxxxxxxxxxxxxx","position":{"start":{"line":100,"column":1,"offset":2982},"end":{"line":102,"column":4,"offset":3036},"indent":[1,1]}},{"type":"paragraph","children":[{"type":"text","value":"Next head over to App.js and import and wrap the App with our new Apollo\ncomponent. (I had used the tab template so yours will look a bit different if\nyou chose the blank templete)","position":{"start":{"line":104,"column":1,"offset":3040},"end":{"line":106,"column":30,"offset":3222},"indent":[1,1]}}],"position":{"start":{"line":104,"column":1,"offset":3040},"end":{"line":106,"column":30,"offset":3222},"indent":[1,1]}},{"type":"code","lang":"jsx","meta":null,"value":"import Apollo from \"./constants/apollo\";\n//.....lots of code\n\nreturn (\n  <Apollo>\n    <View style={styles.container}>\n      {Platform.OS === \"ios\" && <StatusBar barStyle=\"dark-content\" />}\n      <NavigationContainer linking={LinkingConfiguration}>\n        <Stack.Navigator>\n          <Stack.Screen name=\"Root\" component={BottomTabNavigator} />\n        </Stack.Navigator>\n      </NavigationContainer>\n    </View>\n  </Apollo>\n);","position":{"start":{"line":108,"column":1,"offset":3226},"end":{"line":124,"column":4,"offset":3679},"indent":[1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1]}},{"type":"heading","depth":2,"children":[{"type":"text","value":"Our schema","position":{"start":{"line":126,"column":4,"offset":3686},"end":{"line":126,"column":14,"offset":3696},"indent":[]}}],"position":{"start":{"line":126,"column":1,"offset":3683},"end":{"line":126,"column":14,"offset":3696},"indent":[]}},{"type":"paragraph","children":[{"type":"text","value":"Now we can add a schema, which we will import into our Fauna database via their\ndashboard. Inside the constants folder create a new file named schema.gql.","position":{"start":{"line":128,"column":1,"offset":3700},"end":{"line":129,"column":75,"offset":3855},"indent":[1]}}],"position":{"start":{"line":128,"column":1,"offset":3700},"end":{"line":129,"column":75,"offset":3855},"indent":[1]}},{"type":"code","lang":"gql","meta":null,"value":"type Query {\n  allUsers: [User]\n}\n\ntype User {\n  name: String!\n  email: String!\n}","position":{"start":{"line":131,"column":1,"offset":3859},"end":{"line":140,"column":4,"offset":3960},"indent":[1,1,1,1,1,1,1,1,1]}},{"type":"paragraph","children":[{"type":"text","value":"Back on the Fauna dashboard click the graphql tab on the left and import the\nschema. Once done you will be presented with a graphql playground. Add some\nusers to our database.","position":{"start":{"line":142,"column":1,"offset":3964},"end":{"line":144,"column":23,"offset":4141},"indent":[1,1]}}],"position":{"start":{"line":142,"column":1,"offset":3964},"end":{"line":144,"column":23,"offset":4141},"indent":[1,1]}},{"type":"code","lang":"bash","meta":null,"value":"mutation {\n    createUser(\n      data: {\n        name: \"Richard Haines\"\n        email: \"hello@richardhaines.dev\"\n      }\n    ) {\n      _id\n      name\n      email\n    }\n  }","position":{"start":{"line":146,"column":1,"offset":4145},"end":{"line":159,"column":4,"offset":4341},"indent":[1,1,1,1,1,1,1,1,1,1,1,1,1]}},{"type":"paragraph","children":[{"type":"text","value":"Ok cool, now we can setup our serverless function. Create a new project and\ninitialize it.","position":{"start":{"line":161,"column":1,"offset":4345},"end":{"line":162,"column":15,"offset":4436},"indent":[1]}}],"position":{"start":{"line":161,"column":1,"offset":4345},"end":{"line":162,"column":15,"offset":4436},"indent":[1]}},{"type":"code","lang":"bash","meta":null,"value":"mkdir mySuperAPI\ncd mySuperAPI\nyarn init -y","position":{"start":{"line":164,"column":1,"offset":4440},"end":{"line":168,"column":4,"offset":4499},"indent":[1,1,1,1]}},{"type":"paragraph","children":[{"type":"text","value":"Vercel expects us to have an api folder so create that. We will also want to\ninstall some packages here.","position":{"start":{"line":170,"column":1,"offset":4503},"end":{"line":171,"column":28,"offset":4608},"indent":[1]}}],"position":{"start":{"line":170,"column":1,"offset":4503},"end":{"line":171,"column":28,"offset":4608},"indent":[1]}},{"type":"code","lang":"bash","meta":null,"value":"yarn add @now/node apollo-link-http apollo-server-micro dotenv graphql graphql-tag isomorphic-fetch","position":{"start":{"line":173,"column":1,"offset":4612},"end":{"line":175,"column":4,"offset":4725},"indent":[1,1]}},{"type":"paragraph","children":[{"type":"text","value":"Inside the api folder create a new folder that begins with an underscore, this\nis so that vercel knows not to build it's content as a functions. Inside that\nfolder create a new file named config.js.","position":{"start":{"line":177,"column":1,"offset":4729},"end":{"line":179,"column":42,"offset":4929},"indent":[1,1]}}],"position":{"start":{"line":177,"column":1,"offset":4729},"end":{"line":179,"column":42,"offset":4929},"indent":[1,1]}},{"type":"code","lang":"bash","meta":null,"value":"cd api\nmkdir _utils\ncd _utils && touch config.js","position":{"start":{"line":181,"column":1,"offset":4933},"end":{"line":185,"column":4,"offset":4997},"indent":[1,1,1,1]}},{"type":"paragraph","children":[{"type":"text","value":"Create a .env file at the root and add the Fauna server key. Then in the new\nconfig.js file add the following. This is basically a short cut for us having to\ntype out process.env.MY_KEY. Right now we only have one key but we might want to\nadd more later. I find this a handy little file to use.","position":{"start":{"line":187,"column":1,"offset":5001},"end":{"line":190,"column":56,"offset":5298},"indent":[1,1,1]}}],"position":{"start":{"line":187,"column":1,"offset":5001},"end":{"line":190,"column":56,"offset":5298},"indent":[1,1,1]}},{"type":"code","lang":"js","meta":null,"value":"const dotenv = require(\"dotenv\");\ndotenv.config();\nmodule.exports = {\n  faunaServerKey: process.env.FAUNA_SERVER\n};","position":{"start":{"line":192,"column":1,"offset":5302},"end":{"line":198,"column":4,"offset":5433},"indent":[1,1,1,1,1,1]}},{"type":"heading","depth":2,"children":[{"type":"text","value":"Graphql","position":{"start":{"line":200,"column":4,"offset":5440},"end":{"line":200,"column":11,"offset":5447},"indent":[]}}],"position":{"start":{"line":200,"column":1,"offset":5437},"end":{"line":200,"column":11,"offset":5447},"indent":[]}},{"type":"paragraph","children":[{"type":"text","value":"Back to the api folder create a new file called graphql.js and add the\nfollowing.","position":{"start":{"line":202,"column":1,"offset":5451},"end":{"line":203,"column":11,"offset":5533},"indent":[1]}}],"position":{"start":{"line":202,"column":1,"offset":5451},"end":{"line":203,"column":11,"offset":5533},"indent":[1]}},{"type":"code","lang":"js","meta":null,"value":"const { faunaServer } = require(\"./config\");\nconst { createHttpLink } = require(\"apollo-link-http\");\nconst {\n  ApolloServer,\n  makeRemoteExecutableSchema,\n  introspectSchema\n} = require(\"apollo-server-micro\");\nconst fetch = require(\"isomorphic-fetch\");\n\nconst link = createHttpLink({\n  uri: \"https://graphql.fauna.com/graphql\",\n  fetch,\n  headers: {\n    Authorization: `Bearer ${faunaServer}`\n  }\n});\n\nconst schema = makeRemoteExecutableSchema({\n  schema: introspectSchema(link),\n  link\n});\n\nconst server = new ApolloServer({\n  schema,\n  playground: true,\n  introspection: true\n});\n\nmodule.exports = (req, res, ...args) => {\n  if (req.method === \"OPTIONS\") return res.status(200).send();\n\n  const handler = server.createHandler();\n\n  return handler(req, res, ...args);\n};","position":{"start":{"line":205,"column":1,"offset":5537},"end":{"line":241,"column":4,"offset":6354},"indent":[1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1]}},{"type":"paragraph","children":[{"type":"text","value":"Run now from the mySuperAPI root and deploy the API. Head back over to the app\nand open the HomeScreen.js file located in the screens folder. Import gql and\nthe useQuery hook from Apollo. Add a query to get all the users you just created\nand use the useQuery hook to display the returned data.","position":{"start":{"line":243,"column":1,"offset":6358},"end":{"line":246,"column":56,"offset":6654},"indent":[1,1,1]}}],"position":{"start":{"line":243,"column":1,"offset":6358},"end":{"line":246,"column":56,"offset":6654},"indent":[1,1,1]}},{"type":"code","lang":"jsx","meta":null,"value":"import { gql, useQuery } from \"@apollo/client\";\n\nconst GET_USERS = gql`\n  query GetUsers {\n    allUsers {\n      data {\n        name\n        location\n        _id\n      }\n    }\n  }\n`;\n\nexport default function HomeScreen() {\n\n  const {\n    loading,\n    error,\n    data\n  } = useQuery(GET_USERS);\n\n  return (\n    <View style={styles.container}>\n      <ScrollView\n        style={styles.container}\n        contentContainerStyle={styles.contentContainer}\n      >\n        <View style={styles.getStartedContainer}>\n\n            {!loading && !error && data.allUsers.data.map((user) => (\n              <Text key={user._id}>{user.name}</Text>\n            ))}\n      </ScrollView>\n    </View>\n  );\n}\n","position":{"start":{"line":248,"column":1,"offset":6658},"end":{"line":287,"column":4,"offset":7394},"indent":[1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1]}},{"type":"paragraph","children":[{"type":"text","value":"Now its time to run the app and bask in your glory!","position":{"start":{"line":289,"column":1,"offset":7398},"end":{"line":289,"column":52,"offset":7449},"indent":[]}}],"position":{"start":{"line":289,"column":1,"offset":7398},"end":{"line":289,"column":52,"offset":7449},"indent":[]}},{"type":"code","lang":"bash","meta":null,"value":"yarn start","position":{"start":{"line":291,"column":1,"offset":7453},"end":{"line":293,"column":4,"offset":7477},"indent":[1,1]}},{"type":"paragraph","children":[{"type":"text","value":"You have multiple options to view your app, the easiest is to just scan the QR\ncode on the metro bundler browser screen.","position":{"start":{"line":295,"column":1,"offset":7481},"end":{"line":296,"column":42,"offset":7602},"indent":[1]}}],"position":{"start":{"line":295,"column":1,"offset":7481},"end":{"line":296,"column":42,"offset":7602},"indent":[1]}},{"type":"paragraph","children":[{"type":"text","value":"You now have a working mobile app which is pulling data with Apollo from FaunaDB\nvia a serverless API hosted on Vercel. Yay for technology! 🤩","position":{"start":{"line":298,"column":1,"offset":7606},"end":{"line":299,"column":62,"offset":7749},"indent":[1]}}],"position":{"start":{"line":298,"column":1,"offset":7606},"end":{"line":299,"column":62,"offset":7749},"indent":[1]}},{"type":"export","value":"export const _frontmatter = {\"title\":\"Setup Expo with FaunaDB via Vercel\",\"date\":\"2020-05-11T00:00:00.000Z\",\"published\":true,\"category\":\"Serverless\",\"author\":\"Richard Haines\",\"keywords\":[\"expo\",\"react-native\",\"faunadb\",\"vercel\"],\"pin\":false}","position":{"start":{"line":302,"column":1,"offset":7753},"end":{"line":302,"column":242,"offset":7994},"indent":[]}}],"position":{"start":{"line":1,"column":1,"offset":0},"end":{"line":302,"column":242,"offset":7994}}},"scopeImports":["import React from 'react'"],"scopeIdentifiers":["React"],"body":"function _extends() { _extends = Object.assign || function (target) { for (var i = 1; i < arguments.length; i++) { var source = arguments[i]; for (var key in source) { if (Object.prototype.hasOwnProperty.call(source, key)) { target[key] = source[key]; } } } return target; }; return _extends.apply(this, arguments); }\n\nfunction _objectWithoutProperties(source, excluded) { if (source == null) return {}; var target = _objectWithoutPropertiesLoose(source, excluded); var key, i; if (Object.getOwnPropertySymbols) { var sourceSymbolKeys = Object.getOwnPropertySymbols(source); for (i = 0; i < sourceSymbolKeys.length; i++) { key = sourceSymbolKeys[i]; if (excluded.indexOf(key) >= 0) continue; if (!Object.prototype.propertyIsEnumerable.call(source, key)) continue; target[key] = source[key]; } } return target; }\n\nfunction _objectWithoutPropertiesLoose(source, excluded) { if (source == null) return {}; var target = {}; var sourceKeys = Object.keys(source); var key, i; for (i = 0; i < sourceKeys.length; i++) { key = sourceKeys[i]; if (excluded.indexOf(key) >= 0) continue; target[key] = source[key]; } return target; }\n\n/* @jsx mdx */\nvar _frontmatter = {\n  \"title\": \"Setup Expo with FaunaDB via Vercel\",\n  \"date\": \"2020-05-11T00:00:00.000Z\",\n  \"published\": true,\n  \"category\": \"Serverless\",\n  \"author\": \"Richard Haines\",\n  \"keywords\": [\"expo\", \"react-native\", \"faunadb\", \"vercel\"],\n  \"pin\": false\n};\n\nvar makeShortcode = function makeShortcode(name) {\n  return function MDXDefaultShortcode(props) {\n    console.warn(\"Component \" + name + \" was not imported, exported, or provided by MDXProvider as global scope\");\n    return mdx(\"div\", props);\n  };\n};\n\nvar layoutProps = {\n  _frontmatter: _frontmatter\n};\nvar MDXLayout = \"wrapper\";\nreturn function MDXContent(_ref) {\n  var components = _ref.components,\n      props = _objectWithoutProperties(_ref, [\"components\"]);\n\n  return mdx(MDXLayout, _extends({}, layoutProps, props, {\n    components: components,\n    mdxType: \"MDXLayout\"\n  }), mdx(\"h2\", {\n    \"id\": \"setup\"\n  }, \"Setup\"), mdx(\"p\", null, \"Im currently working on a project which will be a mobile app for parents to swap\\nunused items. To do this im using \", mdx(\"a\", _extends({\n    parentName: \"p\"\n  }, {\n    \"href\": \"https://expo.io/\"\n  }), \"Expo\"), \" with a\\n\", mdx(\"a\", _extends({\n    parentName: \"p\"\n  }, {\n    \"href\": \"https://fauna.com/\"\n  }), \"FaunaDB\"), \" database. I had already setup a project with Fauna\\nand Gatsby so thought the knowledge transfer would be quite simple. And it was,\\nuntil it wasn't.\"), mdx(\"p\", null, \"The problem with trying to access the Fauna database from a React Native (RN)\\napp is that RN doesn't come with or support the Node Standard Library, which\\nFauna uses. The solution, or the one I found, is to create a separate API to\\nhandle the Fauna side of things and access that API form the app. Let's go\\nthrough a simple setup to see how this is done.\"), mdx(\"p\", null, \"Make sure you have installed the expo-cli and now-cli.\"), mdx(\"pre\", null, mdx(\"code\", _extends({\n    parentName: \"pre\"\n  }, {\n    \"className\": \"language-bash\"\n  }), \"yarn global add expo-cli\\nyarn global add vercel\\n\")), mdx(\"p\", null, \"Create a new expo project, follow the instructions (you can choose a blank or\\ntabs template) and open your code editor\"), mdx(\"pre\", null, mdx(\"code\", _extends({\n    parentName: \"pre\"\n  }, {\n    \"className\": \"language-bash\"\n  }), \"expo init myProject\\ncd myProject\\ncode .\\n\")), mdx(\"p\", null, \"Ok, leave the app for a minute and login to your Fauna account, create a new\\ndatabase and name it whatever you like. Perhaps MySuperDB? Create a new key with\\na server role. Name it FAUNA_SERVER. Make a note of it as it wont be shown\\nagain.\"), mdx(\"p\", null, \"Back to our app we now need to add some packages. Its a long list so just do it\\nall in one.\"), mdx(\"pre\", null, mdx(\"code\", _extends({\n    parentName: \"pre\"\n  }, {\n    \"className\": \"language-bash\"\n  }), \"yarn add @apollo/client apollo-link-context apollo-link-http graphql graphql-tag isomorphic-fetch\\n\\nyarn add react-native-dotenv -D\\n\")), mdx(\"h2\", {\n    \"id\": \"adding-apollo\"\n  }, \"Adding Apollo\"), mdx(\"p\", null, \"First we want to setup our Apollo Provider which will wrap our root component,\\nApp.js. Create a new file in the constants folder and name it apollo.js\"), mdx(\"pre\", null, mdx(\"code\", _extends({\n    parentName: \"pre\"\n  }, {\n    \"className\": \"language-jsx\"\n  }), \"const React = require(\\\"react\\\");\\nimport { FAUNA_SERVER } from \\\"react-native-dotenv\\\";\\nconst {\\n  ApolloProvider,\\n  ApolloClient,\\n  InMemoryCache\\n} = require(\\\"@apollo/client\\\");\\nconst { setContext } = require(\\\"apollo-link-context\\\");\\nconst { createHttpLink } = require(\\\"apollo-link-http\\\");\\nconst fetch = require(\\\"isomorphic-fetch\\\");\\n\\nconst httpLink = createHttpLink({\\n  uri: \\\"https://graphql.fauna.com/graphql\\\",\\n  fetch\\n});\\n\\nconst authLink = setContext((_, { headers }) => {\\n  return {\\n    headers: {\\n      ...headers,\\n      authorization: `Bearer ${FAUNA_SERVER}`\\n    }\\n  };\\n});\\n\\nconst client = new ApolloClient({\\n  link: authLink.concat(httpLink),\\n  cache: new InMemoryCache()\\n});\\n\\nconst Apollo = ({ children }) => (\\n  <ApolloProvider client={client}>{children}</ApolloProvider>\\n);\\n\\nexport default Apollo;\\n\")), mdx(\"p\", null, \"The above code can be boiled down to:\"), mdx(\"ul\", null, mdx(\"li\", {\n    parentName: \"ul\"\n  }, \"Created a new http link\"), mdx(\"li\", {\n    parentName: \"ul\"\n  }, \"Create an auth link which returns the headers to the context so the http link\\ncan read them. Here we pass in our Fauna key with server rights.\"), mdx(\"li\", {\n    parentName: \"ul\"\n  }, \"Then we create the client to be passed to the provider with the link now set\\nas the auth link.\")), mdx(\"p\", null, \"Create a new .env file at the projects root and add your fauna server key, using\\nthe name we gave it in our fauna dashboard.\"), mdx(\"pre\", null, mdx(\"code\", _extends({\n    parentName: \"pre\"\n  }, {\n    \"className\": \"language-bash\"\n  }), \"FAUNA_SERVER=xxxxxxxxxxxxxxxxxxxxxxxxxxx\\n\")), mdx(\"p\", null, \"Next head over to App.js and import and wrap the App with our new Apollo\\ncomponent. (I had used the tab template so yours will look a bit different if\\nyou chose the blank templete)\"), mdx(\"pre\", null, mdx(\"code\", _extends({\n    parentName: \"pre\"\n  }, {\n    \"className\": \"language-jsx\"\n  }), \"import Apollo from \\\"./constants/apollo\\\";\\n//.....lots of code\\n\\nreturn (\\n  <Apollo>\\n    <View style={styles.container}>\\n      {Platform.OS === \\\"ios\\\" && <StatusBar barStyle=\\\"dark-content\\\" />}\\n      <NavigationContainer linking={LinkingConfiguration}>\\n        <Stack.Navigator>\\n          <Stack.Screen name=\\\"Root\\\" component={BottomTabNavigator} />\\n        </Stack.Navigator>\\n      </NavigationContainer>\\n    </View>\\n  </Apollo>\\n);\\n\")), mdx(\"h2\", {\n    \"id\": \"our-schema\"\n  }, \"Our schema\"), mdx(\"p\", null, \"Now we can add a schema, which we will import into our Fauna database via their\\ndashboard. Inside the constants folder create a new file named schema.gql.\"), mdx(\"pre\", null, mdx(\"code\", _extends({\n    parentName: \"pre\"\n  }, {\n    \"className\": \"language-gql\"\n  }), \"type Query {\\n  allUsers: [User]\\n}\\n\\ntype User {\\n  name: String!\\n  email: String!\\n}\\n\")), mdx(\"p\", null, \"Back on the Fauna dashboard click the graphql tab on the left and import the\\nschema. Once done you will be presented with a graphql playground. Add some\\nusers to our database.\"), mdx(\"pre\", null, mdx(\"code\", _extends({\n    parentName: \"pre\"\n  }, {\n    \"className\": \"language-bash\"\n  }), \"mutation {\\n    createUser(\\n      data: {\\n        name: \\\"Richard Haines\\\"\\n        email: \\\"hello@richardhaines.dev\\\"\\n      }\\n    ) {\\n      _id\\n      name\\n      email\\n    }\\n  }\\n\")), mdx(\"p\", null, \"Ok cool, now we can setup our serverless function. Create a new project and\\ninitialize it.\"), mdx(\"pre\", null, mdx(\"code\", _extends({\n    parentName: \"pre\"\n  }, {\n    \"className\": \"language-bash\"\n  }), \"mkdir mySuperAPI\\ncd mySuperAPI\\nyarn init -y\\n\")), mdx(\"p\", null, \"Vercel expects us to have an api folder so create that. We will also want to\\ninstall some packages here.\"), mdx(\"pre\", null, mdx(\"code\", _extends({\n    parentName: \"pre\"\n  }, {\n    \"className\": \"language-bash\"\n  }), \"yarn add @now/node apollo-link-http apollo-server-micro dotenv graphql graphql-tag isomorphic-fetch\\n\")), mdx(\"p\", null, \"Inside the api folder create a new folder that begins with an underscore, this\\nis so that vercel knows not to build it's content as a functions. Inside that\\nfolder create a new file named config.js.\"), mdx(\"pre\", null, mdx(\"code\", _extends({\n    parentName: \"pre\"\n  }, {\n    \"className\": \"language-bash\"\n  }), \"cd api\\nmkdir _utils\\ncd _utils && touch config.js\\n\")), mdx(\"p\", null, \"Create a .env file at the root and add the Fauna server key. Then in the new\\nconfig.js file add the following. This is basically a short cut for us having to\\ntype out process.env.MY_KEY. Right now we only have one key but we might want to\\nadd more later. I find this a handy little file to use.\"), mdx(\"pre\", null, mdx(\"code\", _extends({\n    parentName: \"pre\"\n  }, {\n    \"className\": \"language-js\"\n  }), \"const dotenv = require(\\\"dotenv\\\");\\ndotenv.config();\\nmodule.exports = {\\n  faunaServerKey: process.env.FAUNA_SERVER\\n};\\n\")), mdx(\"h2\", {\n    \"id\": \"graphql\"\n  }, \"Graphql\"), mdx(\"p\", null, \"Back to the api folder create a new file called graphql.js and add the\\nfollowing.\"), mdx(\"pre\", null, mdx(\"code\", _extends({\n    parentName: \"pre\"\n  }, {\n    \"className\": \"language-js\"\n  }), \"const { faunaServer } = require(\\\"./config\\\");\\nconst { createHttpLink } = require(\\\"apollo-link-http\\\");\\nconst {\\n  ApolloServer,\\n  makeRemoteExecutableSchema,\\n  introspectSchema\\n} = require(\\\"apollo-server-micro\\\");\\nconst fetch = require(\\\"isomorphic-fetch\\\");\\n\\nconst link = createHttpLink({\\n  uri: \\\"https://graphql.fauna.com/graphql\\\",\\n  fetch,\\n  headers: {\\n    Authorization: `Bearer ${faunaServer}`\\n  }\\n});\\n\\nconst schema = makeRemoteExecutableSchema({\\n  schema: introspectSchema(link),\\n  link\\n});\\n\\nconst server = new ApolloServer({\\n  schema,\\n  playground: true,\\n  introspection: true\\n});\\n\\nmodule.exports = (req, res, ...args) => {\\n  if (req.method === \\\"OPTIONS\\\") return res.status(200).send();\\n\\n  const handler = server.createHandler();\\n\\n  return handler(req, res, ...args);\\n};\\n\")), mdx(\"p\", null, \"Run now from the mySuperAPI root and deploy the API. Head back over to the app\\nand open the HomeScreen.js file located in the screens folder. Import gql and\\nthe useQuery hook from Apollo. Add a query to get all the users you just created\\nand use the useQuery hook to display the returned data.\"), mdx(\"pre\", null, mdx(\"code\", _extends({\n    parentName: \"pre\"\n  }, {\n    \"className\": \"language-jsx\"\n  }), \"import { gql, useQuery } from \\\"@apollo/client\\\";\\n\\nconst GET_USERS = gql`\\n  query GetUsers {\\n    allUsers {\\n      data {\\n        name\\n        location\\n        _id\\n      }\\n    }\\n  }\\n`;\\n\\nexport default function HomeScreen() {\\n\\n  const {\\n    loading,\\n    error,\\n    data\\n  } = useQuery(GET_USERS);\\n\\n  return (\\n    <View style={styles.container}>\\n      <ScrollView\\n        style={styles.container}\\n        contentContainerStyle={styles.contentContainer}\\n      >\\n        <View style={styles.getStartedContainer}>\\n\\n            {!loading && !error && data.allUsers.data.map((user) => (\\n              <Text key={user._id}>{user.name}</Text>\\n            ))}\\n      </ScrollView>\\n    </View>\\n  );\\n}\\n\\n\")), mdx(\"p\", null, \"Now its time to run the app and bask in your glory!\"), mdx(\"pre\", null, mdx(\"code\", _extends({\n    parentName: \"pre\"\n  }, {\n    \"className\": \"language-bash\"\n  }), \"yarn start\\n\")), mdx(\"p\", null, \"You have multiple options to view your app, the easiest is to just scan the QR\\ncode on the metro bundler browser screen.\"), mdx(\"p\", null, \"You now have a working mobile app which is pulling data with Apollo from FaunaDB\\nvia a serverless API hosted on Vercel. Yay for technology! \\uD83E\\uDD29\"));\n}\n;\nMDXContent.isMDXComponent = true;","rawMDXOutput":"/* @jsx mdx */\nimport { mdx } from '@mdx-js/react';\n/* @jsx mdx */\n\nexport const _frontmatter = {\n  \"title\": \"Setup Expo with FaunaDB via Vercel\",\n  \"date\": \"2020-05-11T00:00:00.000Z\",\n  \"published\": true,\n  \"category\": \"Serverless\",\n  \"author\": \"Richard Haines\",\n  \"keywords\": [\"expo\", \"react-native\", \"faunadb\", \"vercel\"],\n  \"pin\": false\n};\nconst makeShortcode = name => function MDXDefaultShortcode(props) {\n  console.warn(\"Component \" + name + \" was not imported, exported, or provided by MDXProvider as global scope\")\n  return <div {...props}/>\n};\n\nconst layoutProps = {\n  _frontmatter\n};\nconst MDXLayout = \"wrapper\"\nexport default function MDXContent({\n  components,\n  ...props\n}) {\n  return <MDXLayout {...layoutProps} {...props} components={components} mdxType=\"MDXLayout\">\n    <h2 {...{\n      \"id\": \"setup\"\n    }}>{`Setup`}</h2>\n    <p>{`Im currently working on a project which will be a mobile app for parents to swap\nunused items. To do this im using `}<a parentName=\"p\" {...{\n        \"href\": \"https://expo.io/\"\n      }}>{`Expo`}</a>{` with a\n`}<a parentName=\"p\" {...{\n        \"href\": \"https://fauna.com/\"\n      }}>{`FaunaDB`}</a>{` database. I had already setup a project with Fauna\nand Gatsby so thought the knowledge transfer would be quite simple. And it was,\nuntil it wasn't.`}</p>\n    <p>{`The problem with trying to access the Fauna database from a React Native (RN)\napp is that RN doesn't come with or support the Node Standard Library, which\nFauna uses. The solution, or the one I found, is to create a separate API to\nhandle the Fauna side of things and access that API form the app. Let's go\nthrough a simple setup to see how this is done.`}</p>\n    <p>{`Make sure you have installed the expo-cli and now-cli.`}</p>\n    <pre><code parentName=\"pre\" {...{\n        \"className\": \"language-bash\"\n      }}>{`yarn global add expo-cli\nyarn global add vercel\n`}</code></pre>\n    <p>{`Create a new expo project, follow the instructions (you can choose a blank or\ntabs template) and open your code editor`}</p>\n    <pre><code parentName=\"pre\" {...{\n        \"className\": \"language-bash\"\n      }}>{`expo init myProject\ncd myProject\ncode .\n`}</code></pre>\n    <p>{`Ok, leave the app for a minute and login to your Fauna account, create a new\ndatabase and name it whatever you like. Perhaps MySuperDB? Create a new key with\na server role. Name it FAUNA_SERVER. Make a note of it as it wont be shown\nagain.`}</p>\n    <p>{`Back to our app we now need to add some packages. Its a long list so just do it\nall in one.`}</p>\n    <pre><code parentName=\"pre\" {...{\n        \"className\": \"language-bash\"\n      }}>{`yarn add @apollo/client apollo-link-context apollo-link-http graphql graphql-tag isomorphic-fetch\n\nyarn add react-native-dotenv -D\n`}</code></pre>\n    <h2 {...{\n      \"id\": \"adding-apollo\"\n    }}>{`Adding Apollo`}</h2>\n    <p>{`First we want to setup our Apollo Provider which will wrap our root component,\nApp.js. Create a new file in the constants folder and name it apollo.js`}</p>\n    <pre><code parentName=\"pre\" {...{\n        \"className\": \"language-jsx\"\n      }}>{`const React = require(\"react\");\nimport { FAUNA_SERVER } from \"react-native-dotenv\";\nconst {\n  ApolloProvider,\n  ApolloClient,\n  InMemoryCache\n} = require(\"@apollo/client\");\nconst { setContext } = require(\"apollo-link-context\");\nconst { createHttpLink } = require(\"apollo-link-http\");\nconst fetch = require(\"isomorphic-fetch\");\n\nconst httpLink = createHttpLink({\n  uri: \"https://graphql.fauna.com/graphql\",\n  fetch\n});\n\nconst authLink = setContext((_, { headers }) => {\n  return {\n    headers: {\n      ...headers,\n      authorization: \\`Bearer \\${FAUNA_SERVER}\\`\n    }\n  };\n});\n\nconst client = new ApolloClient({\n  link: authLink.concat(httpLink),\n  cache: new InMemoryCache()\n});\n\nconst Apollo = ({ children }) => (\n  <ApolloProvider client={client}>{children}</ApolloProvider>\n);\n\nexport default Apollo;\n`}</code></pre>\n    <p>{`The above code can be boiled down to:`}</p>\n    <ul>\n      <li parentName=\"ul\">{`Created a new http link`}</li>\n      <li parentName=\"ul\">{`Create an auth link which returns the headers to the context so the http link\ncan read them. Here we pass in our Fauna key with server rights.`}</li>\n      <li parentName=\"ul\">{`Then we create the client to be passed to the provider with the link now set\nas the auth link.`}</li>\n    </ul>\n    <p>{`Create a new .env file at the projects root and add your fauna server key, using\nthe name we gave it in our fauna dashboard.`}</p>\n    <pre><code parentName=\"pre\" {...{\n        \"className\": \"language-bash\"\n      }}>{`FAUNA_SERVER=xxxxxxxxxxxxxxxxxxxxxxxxxxx\n`}</code></pre>\n    <p>{`Next head over to App.js and import and wrap the App with our new Apollo\ncomponent. (I had used the tab template so yours will look a bit different if\nyou chose the blank templete)`}</p>\n    <pre><code parentName=\"pre\" {...{\n        \"className\": \"language-jsx\"\n      }}>{`import Apollo from \"./constants/apollo\";\n//.....lots of code\n\nreturn (\n  <Apollo>\n    <View style={styles.container}>\n      {Platform.OS === \"ios\" && <StatusBar barStyle=\"dark-content\" />}\n      <NavigationContainer linking={LinkingConfiguration}>\n        <Stack.Navigator>\n          <Stack.Screen name=\"Root\" component={BottomTabNavigator} />\n        </Stack.Navigator>\n      </NavigationContainer>\n    </View>\n  </Apollo>\n);\n`}</code></pre>\n    <h2 {...{\n      \"id\": \"our-schema\"\n    }}>{`Our schema`}</h2>\n    <p>{`Now we can add a schema, which we will import into our Fauna database via their\ndashboard. Inside the constants folder create a new file named schema.gql.`}</p>\n    <pre><code parentName=\"pre\" {...{\n        \"className\": \"language-gql\"\n      }}>{`type Query {\n  allUsers: [User]\n}\n\ntype User {\n  name: String!\n  email: String!\n}\n`}</code></pre>\n    <p>{`Back on the Fauna dashboard click the graphql tab on the left and import the\nschema. Once done you will be presented with a graphql playground. Add some\nusers to our database.`}</p>\n    <pre><code parentName=\"pre\" {...{\n        \"className\": \"language-bash\"\n      }}>{`mutation {\n    createUser(\n      data: {\n        name: \"Richard Haines\"\n        email: \"hello@richardhaines.dev\"\n      }\n    ) {\n      _id\n      name\n      email\n    }\n  }\n`}</code></pre>\n    <p>{`Ok cool, now we can setup our serverless function. Create a new project and\ninitialize it.`}</p>\n    <pre><code parentName=\"pre\" {...{\n        \"className\": \"language-bash\"\n      }}>{`mkdir mySuperAPI\ncd mySuperAPI\nyarn init -y\n`}</code></pre>\n    <p>{`Vercel expects us to have an api folder so create that. We will also want to\ninstall some packages here.`}</p>\n    <pre><code parentName=\"pre\" {...{\n        \"className\": \"language-bash\"\n      }}>{`yarn add @now/node apollo-link-http apollo-server-micro dotenv graphql graphql-tag isomorphic-fetch\n`}</code></pre>\n    <p>{`Inside the api folder create a new folder that begins with an underscore, this\nis so that vercel knows not to build it's content as a functions. Inside that\nfolder create a new file named config.js.`}</p>\n    <pre><code parentName=\"pre\" {...{\n        \"className\": \"language-bash\"\n      }}>{`cd api\nmkdir _utils\ncd _utils && touch config.js\n`}</code></pre>\n    <p>{`Create a .env file at the root and add the Fauna server key. Then in the new\nconfig.js file add the following. This is basically a short cut for us having to\ntype out process.env.MY_KEY. Right now we only have one key but we might want to\nadd more later. I find this a handy little file to use.`}</p>\n    <pre><code parentName=\"pre\" {...{\n        \"className\": \"language-js\"\n      }}>{`const dotenv = require(\"dotenv\");\ndotenv.config();\nmodule.exports = {\n  faunaServerKey: process.env.FAUNA_SERVER\n};\n`}</code></pre>\n    <h2 {...{\n      \"id\": \"graphql\"\n    }}>{`Graphql`}</h2>\n    <p>{`Back to the api folder create a new file called graphql.js and add the\nfollowing.`}</p>\n    <pre><code parentName=\"pre\" {...{\n        \"className\": \"language-js\"\n      }}>{`const { faunaServer } = require(\"./config\");\nconst { createHttpLink } = require(\"apollo-link-http\");\nconst {\n  ApolloServer,\n  makeRemoteExecutableSchema,\n  introspectSchema\n} = require(\"apollo-server-micro\");\nconst fetch = require(\"isomorphic-fetch\");\n\nconst link = createHttpLink({\n  uri: \"https://graphql.fauna.com/graphql\",\n  fetch,\n  headers: {\n    Authorization: \\`Bearer \\${faunaServer}\\`\n  }\n});\n\nconst schema = makeRemoteExecutableSchema({\n  schema: introspectSchema(link),\n  link\n});\n\nconst server = new ApolloServer({\n  schema,\n  playground: true,\n  introspection: true\n});\n\nmodule.exports = (req, res, ...args) => {\n  if (req.method === \"OPTIONS\") return res.status(200).send();\n\n  const handler = server.createHandler();\n\n  return handler(req, res, ...args);\n};\n`}</code></pre>\n    <p>{`Run now from the mySuperAPI root and deploy the API. Head back over to the app\nand open the HomeScreen.js file located in the screens folder. Import gql and\nthe useQuery hook from Apollo. Add a query to get all the users you just created\nand use the useQuery hook to display the returned data.`}</p>\n    <pre><code parentName=\"pre\" {...{\n        \"className\": \"language-jsx\"\n      }}>{`import { gql, useQuery } from \"@apollo/client\";\n\nconst GET_USERS = gql\\`\n  query GetUsers {\n    allUsers {\n      data {\n        name\n        location\n        _id\n      }\n    }\n  }\n\\`;\n\nexport default function HomeScreen() {\n\n  const {\n    loading,\n    error,\n    data\n  } = useQuery(GET_USERS);\n\n  return (\n    <View style={styles.container}>\n      <ScrollView\n        style={styles.container}\n        contentContainerStyle={styles.contentContainer}\n      >\n        <View style={styles.getStartedContainer}>\n\n            {!loading && !error && data.allUsers.data.map((user) => (\n              <Text key={user._id}>{user.name}</Text>\n            ))}\n      </ScrollView>\n    </View>\n  );\n}\n\n`}</code></pre>\n    <p>{`Now its time to run the app and bask in your glory!`}</p>\n    <pre><code parentName=\"pre\" {...{\n        \"className\": \"language-bash\"\n      }}>{`yarn start\n`}</code></pre>\n    <p>{`You have multiple options to view your app, the easiest is to just scan the QR\ncode on the metro bundler browser screen.`}</p>\n    <p>{`You now have a working mobile app which is pulling data with Apollo from FaunaDB\nvia a serverless API hosted on Vercel. Yay for technology! 🤩`}</p>\n\n    </MDXLayout>;\n}\n\n;\nMDXContent.isMDXComponent = true;"}}